<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Sistema de Laudos Digitais - Hospital São Rafael</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/components.css">
    <link rel="stylesheet" href="src/styles/layout.css">
    <link rel="stylesheet" href="src/styles/preview.css">
    <link rel="stylesheet" href="src/styles/responsive.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Slab:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Cabeçalho -->
        <header class="app-header">
            <div class="header-left">
                <div class="hospital-logo">
                    <img src="assets/logo.png" alt="HSR">
                    <h1>Hospital São Rafael</h1>
                </div>
                <span class="system-title">Sistema de Laudos Digitais</span>
            </div>
            <div class="header-right">
                <button class="btn-help" title="Ajuda">
                    <i class="fas fa-question-circle"></i>
                </button>
                <div class="auto-save-status">
                    <i class="fas fa-save"></i>
                    <span>Auto-salvo</span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Painel Esquerdo: Formulários -->
            <div class="form-panel">
                <!-- Dados Administrativos -->
                <section class="form-section" id="dados-administrativos">
                    <div class="section-header">
                        <i class="fas fa-user-circle"></i>
                        <h2>Dados do Paciente</h2>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="unidade">Unidade de Atendimento</label>
                            <select id="unidade" class="form-control">
                                <option value="">Selecione...</option>
                                <option value="emergencia">Emergência</option>
                                <option value="laboratorio">Laboratório</option>
                                <option value="imagem">Diagnóstico por Imagem</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="data-exame">Data do Exame</label>
                            <input type="date" id="data-exame" class="form-control" value="">
                        </div>

                        <div class="form-group">
                            <label for="hora-exame">Hora do Exame</label>
                            <input type="time" id="hora-exame" class="form-control" value="">
                        </div>

                        <div class="form-group">
                            <label for="numero-exame">Número do Exame</label>
                            <div class="input-with-action">
                                <input type="text" id="numero-exame" class="form-control"
                                    placeholder="Gerado automaticamente" readonly>
                                <button type="button" id="gerar-numero" class="btn-action" title="Gerar novo número">
                                    <i class="fas fa-redo"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="nome-paciente">Nome Completo do Paciente *</label>
                            <input type="text" id="nome-paciente" class="form-control" required
                                placeholder="Digite o nome completo">
                        </div>

                        <div class="form-group">
                            <label for="documento-tipo">Tipo de Documento</label>
                            <select id="documento-tipo" class="form-control">
                                <option value="Passaporte">Passaporte</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="documento-numero">Número do Documento</label>
                            <input type="text" id="documento-numero" class="form-control" placeholder="Somente números">
                        </div>

                        <div class="form-group">
                            <label for="idade">Idade</label>
                            <div class="idade-input">
                                <input type="number" id="idade" class="form-control" min="0" max="150"
                                    placeholder="Idade">
                                <span class="idade-label">anos</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Dados do Profissional -->
                <section class="form-section" id="dados-profissional">
                    <div class="section-header">
                        <i class="fas fa-user-md"></i>
                        <h2>Profissional Responsável</h2>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="nome-profissional">Nome do Profissional *</label>
                            <input type="text" id="nome-profissional" class="form-control" required
                                placeholder="Nome completo">
                        </div>

                        <div class="form-group">
                            <label>Registro Profissional</label>
                            <div class="professional-register-display">
                                <span class="register-type">
                                    <i class="fas fa-user-md"></i> CRM
                                </span>
                                <input type="text" id="registro-numero" class="form-control"
                                    placeholder="Número do CRM">
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Catálogo de Exames -->
                <section class="form-section" id="catalogo-exames">
                    <div class="section-header">
                        <i class="fas fa-clipboard-list"></i>
                        <h2>Catálogo de Exames</h2>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="busca-exame" placeholder="Buscar exame...">
                        </div>
                    </div>

                    <!-- Categorias -->
                    <div class="categorias-tabs" id="categorias-container">
                        <div class="loading-categories">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Carregando categorias...</span>
                        </div>
                    </div>

                    <div class="exames-grid" id="exames-container">
                        <div class="loading-exames">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Carregando exames...</span>
                        </div>
                    </div>
                </section>

                <!-- Campos do Exame Selecionado -->
                <section class="form-section" id="campos-exame" style="display: none;">
                    <div class="section-header">
                        <i class="fas fa-edit"></i>
                        <h2 id="titulo-exame-selecionado">Exame Selecionado</h2>
                        <button class="btn-close-exame" id="fechar-exame">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="campos-dinamicos">
                        <!-- Campos serão gerados dinamicamente -->
                    </div>
                </section>

                <!-- Upload de Anexos -->
                <section class="form-section" id="upload-anexos">
                    <div class="section-header">
                        <i class="fas fa-paperclip"></i>
                        <h2>Anexos do Exame</h2>
                    </div>

                    <div class="upload-area" id="drop-zone">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>Arraste imagens aqui</h3>
                        <p>ou clique para selecionar</p>
                        <input type="file" id="file-input" accept="image/*" multiple style="display: none;">
                        <button class="btn-select-images" id="btn-select-images">
                            Selecionar Imagens
                        </button>
                        <p class="upload-info">Formatos: JPG, PNG, GIF • Máx: 10MB cada</p>
                    </div>

                    <div class="anexos-container" id="anexos-container">
                        <div class="empty-anexos">
                            <i class="fas fa-paperclip"></i>
                            <p>Nenhum anexo adicionado</p>
                            <small>Os anexos aparecerão em página separada no laudo</small>
                        </div>
                    </div>
                </section>

                <!-- Assinatura Digital -->
                <section class="form-section">
                    <div class="section-header">
                        <i class="fas fa-signature"></i>
                        <h2>Assinatura Digital</h2>
                    </div>

                    <div class="assinatura-simple">
                        <!-- Área de Upload Simples -->
                        <div class="simple-upload-area" id="simple-upload-area">
                            <div class="upload-icon">
                                <i class="fas fa-upload"></i>
                            </div>
                            <div class="upload-text">
                                <p class="upload-title">Clique para carregar assinatura</p>
                                <p class="upload-subtitle">Formato: JPG ou PNG • Máx: 5MB</p>
                            </div>
                        </div>

                        <input type="file" id="simple-assinatura-input" accept="image/jpeg,image/png"
                            style="display: none;">

                        <!-- Preview -->
                        <div class="simple-preview" id="simple-assinatura-preview">
                            <div class="no-signature" id="no-signature">
                                <i class="fas fa-signature"></i>
                                <p>Sem assinatura</p>
                            </div>
                            <img id="simple-assinatura-img" src="" alt="Assinatura">
                        </div>
                    </div>
                </section>
            </div>

            <!-- Painel Direito: Pré-visualização -->
            <div class="preview-panel">
                <div class="preview-header">
                    <h2><i class="fas fa-eye"></i> Pré-visualização do Laudo</h2>
                    <div class="preview-actions">
                        <button class="btn-preview-action" id="atualizar-preview">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                        <button class="btn-preview-action" id="limpar-tudo">
                            <i class="fas fa-trash-alt"></i> Limpar Tudo
                        </button>
                    </div>
                </div>

                <div class="laudo-preview-container">
                    <div class="laudo-preview" id="laudo-container">
                        <!-- Páginas serão renderizadas dinamicamente -->
                    </div>
                </div>

                <!-- Controles -->
                <div class="export-controls">
                    <div class="export-options">
                        <div class="export-option">
                            <i class="fas fa-camera"></i>
                            <span>Exportar como imagem PNG</span>
                        </div>
                        <div class="export-info">
                            <p>Resolução: 300 DPI • Tamanho: A4</p>
                        </div>
                    </div>
                    <div class="paginacao-controls">
                        <!-- Controles de paginação dinâmicos -->
                    </div>
                    <button class="btn-export" id="export-png">
                        <i class="fas fa-download"></i> Exportar Laudo (PNG)
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Ajuda -->
        <div class="modal" id="help-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-question-circle"></i> Ajuda do Sistema</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <h3>Como usar o sistema:</h3>
                    <ol>
                        <li>Preencha os dados do paciente</li>
                        <li>Selecione o profissional responsável</li>
                        <li>Escolha um exame no catálogo</li>
                        <li>Preencha os campos específicos do exame</li>
                        <li>Adicione imagens se necessário</li>
                        <li>Carregue a assinatura digital</li>
                        <li>Verifique a pré-visualização</li>
                        <li>Exporte como imagem PNG</li>
                    </ol>
                    <p><strong>Dica:</strong> Os dados são auto-salvos localmente no seu navegador.</p>
                </div>
            </div>
        </div>

        <!-- Notificação -->
        <div class="notification" id="notification">
            <div class="notification-content">
                <span id="notification-message"></span>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="models.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <!-- Módulos do Sistema -->
    <script src="src/modules/notification.js"></script>
    <script src="src/modules/formHandler.js"></script>
    <script src="src/modules/examCatalog.js"></script>
    <script src="src/modules/signature.js"></script>
    <script src="src/modules/attachments.js"></script>
    <script src="src/modules/draftManager.js"></script>
    <script src="src/modules/preview.js"></script>
    <script src="src/modules/pagination.js"></script>
    <script src="src/modules/export.js"></script>
    <script src="src/app.js"></script>

    <script>
        // Fallback para html2canvas
        window.addEventListener('load', function () {
            setTimeout(function () {
                if (typeof html2canvas === 'undefined') {
                    console.warn('html2canvas não carregou, usando fallback...');
                    const script = document.createElement('script');
                    script.src = 'assets/html2canvas.min.js';
                    document.head.appendChild(script);
                }
            }, 2000);
        });
    </script>
</body>

</html>
  <!-- Desenvolvido por: Luidhy C. dos Santos -->
